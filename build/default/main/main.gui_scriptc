
ìŠ
Šv------------------------------------------------------------------------------------------------
-- Local variable
------------------------------------------------------------------------------------------------
-- ãƒã‚¹ã‚¯ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ã€ãƒœãƒƒã‚¯ã‚¹ã®å¤§ãã•ã‚„ä½ç½®ã‚’å…¥ã‚Œã‚‹å¤‰æ•°
local m = nil -- ãƒã‚¹ã‚¯ã®å¤§ãã•
local s = nil -- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ã®å¤§ãã•
local ks = nil -- ä»®æƒ³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ã®å¤§ãã•
local b = nil -- ãƒœãƒƒã‚¯ã‚¹ã®å¤§ãã•
local bh = nil -- ãƒœãƒƒã‚¯ã‚¹ã®åŠåˆ†
local bm = nil -- ãƒœãƒƒã‚¯ã‚¹ä½™ç™½ã‚’å«ã‚ãŸãƒœãƒƒã‚¯ã‚¹ã®é–“éš”
local visb = 0 -- ãƒœãƒƒã‚¯ã‚¹ã®å¯è¦–ä½ç½®
local invisb = 450 -- ãƒœãƒƒã‚¯ã‚¹ã®ä¸å¯è¦–ä½ç½®
local sbx = 20 -- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®æ¨ªå¹…
-- è¡¨ç¤ºç¯„å›²ã‚’æ±ºã‚ã‚‹ãŸã‚ã®å¤‰æ•°
local view_num = nil -- ä»Šã©ã“ã«ã„ã‚‹ã‹
local next_view = nil -- ã“ã®yåº§æ¨™ã‚ˆã‚Šä¸‹ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ãŸæ™‚æœ€ä¸Šéƒ¨ã®boxãŒæœ€ä¸‹éƒ¨ã«ç§»å‹•ã™ã‚‹
local prev_view = nil -- ã“ã®yåº§æ¨™ã‚ˆã‚Šä¸Šã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ãŸæ™‚æœ€ä¸‹éƒ¨ã®boxãŒæœ€ä¸Šéƒ¨ã«ç§»å‹•ã™ã‚‹
-- ãƒœãƒƒã‚¯ã‚¹æŒ‡å®šç”¨å¤‰æ•°
local box_num = 5 -- ãƒœãƒƒã‚¯ã‚¹ã®æ•°ã€ç”¨æ„ã—ãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ•°ã‚’å…¥åŠ›ã™ã‚‹
local visible_box = 3 -- è¡¨ç¤ºã™ã‚‹ãƒœãƒƒã‚¯ã‚¹ã®æ•°
local box = {} -- è¡¨ç¤ºãƒœãƒƒã‚¯ã‚¹ã®IDãƒ†ãƒ¼ãƒ–ãƒ«
local l_num = nil -- æ›¸ãæ›ãˆå¯¾è±¡ã®ãƒœãƒƒã‚¯ã‚¹
-- ãƒãƒƒã‚·ãƒ¥å‚ç…§ãƒ‡ãƒ¼ã‚¿ã€‚ã“ã“ã«è¨˜å…¥ã—ãŸãƒãƒƒã‚·ãƒ¥ã¯boxãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å„ãƒãƒ¼ãƒ‰ã‚’å‚ç…§ã™ã‚‹ãŸã‚ã«å¿…è¦
local list_box = '/box'
local list_texture = {'/picture', '/team_icon', '/element_icon'}
local list_text = {'/NAME', '/HP', '/SP', '/LUCK', '/ATK', '/DEX', '/AGI', '/rank', '/EXP', '/EXP_max', '/listID'}
-- ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿
local d_num = nil -- ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã®æ•°
local listdata = {} -- ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚ŒãŸãƒ†ãƒ¼ãƒ–ãƒ«
-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å‡¦ç†ã—ã¦ã„ã„ã‹
local scok = true
------------------------------------------------------------------------------------------------
-- Sample for add parameter data
------------------------------------------------------------------------------------------------
-- å‚ç…§ç”¨ãƒ‡ãƒ¼ã‚¿
local paradata = {
	{1, 1, 1, 'a_san', 1, 2, 3, 4, 5, 6, 7, 8, 9},
	{2, 2, 2, 'b_kun', 41, 51, 13, 12, 115, 14, 16, 17, 11},
	{2, 2, 2, 'c_chan', 1, 1, 1, 1, 1, 1, 1, 1, 1}
}

-- ãƒœãƒƒã‚¯ã‚¹è¿½åŠ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š
local function para(self)
	local para = {}
	local t = math.random(1,3)
	for i, p in ipairs(list_text) do
		table.insert(para, i, paradata[t][i + 3])
	end
	para[11] = d_num
	return para
end
------------------------------------------------------------------------------------------------
-- Dirty Larry property
------------------------------------------------------------------------------------------------
-- ãƒãƒ¼ãƒ‰ãŒæœ‰åŠ¹ã‹åˆ¤å®š
function isenabled(self, node)
	local parent = gui.get_parent(node) --è¦ªãŒç„¡ã‹ã£ãŸã‚‰nilã€‚ã‚ã£ãŸã‚‰åå‰ã‚’è¿”ã™
	if parent then
		return isenabled(self, parent) --è¦ªã®åå‰ã‚’è¿”ã™
	end
	return gui.is_enabled(node) --ãƒãƒ¼ãƒ‰ãŒæœ‰åŠ¹ãªã‚‰trueã‚’è¿”ã™ã€‚ç„¡åŠ¹ãªã‚‰falseã‚’è¿”ã™
end
-- è§¦ã£ãŸï¼ˆaction_idï¼‰ã®åå‰ãŒã‚ã‚‹ã‹ã©ã†ã‹åˆ¤å®š
local function safe_get_node(node)
	--ãƒãƒ¼ãƒ‰ãŒã‚ã‚‹ã‹ã€ã‚ã£ãŸã‚‰åå‰ã‚’è¿”ã™
	if
		pcall(
			function()
				gui.get_node(node)
			end
		)
	 then
		return gui.get_node(node)
	else
		return nil
	end
end
-- è§¦ã£ãŸãƒãƒ¼ãƒ‰ãŒæœ‰åŠ¹ã‹ã€€æœ‰åŠ¹ãªã‚‰è§¦ã£ãŸãƒãƒ¼ãƒ‰åã‚’è¿”ã™
local function hit_test(self, node, action_id, action)
	if not isenabled(self, node) then
		return false
	end
	local hit = gui.pick_node(node, action.x, action.y)
	local touch = action_id == hash('touch')
	return touch and hit
end
------------------------------------------------------------------------------------------------
-- rewrite,scrolling,scroll,add,remove
------------------------------------------------------------------------------------------------
-- å¯¾è±¡ã®ãƒœãƒƒã‚¯ã‚¹ã«å€¤ä»£å…¥
local function write(self, bn, ln)
	for i, p in ipairs(list_texture) do
		-- gui.set_texture(box[d_num][p], texture))
	end
	for i, p in ipairs(list_text) do
		-- ãƒœãƒƒã‚¯ã‚¹ã®å„ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ¼ãƒ‰ã«ãƒªã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä»£å…¥
		gui.set_text(gui.get_node(box[bn] .. p), listdata[ln][i])
	end
end
-- å…¨ãƒœãƒƒã‚¯ã‚¹æ›´æ–°
local function allwrite(self)
	local n = 0 -- boxç•ªå·ç”¨
	local f = 0 -- æœ€åˆã®boxã«å¯¾å¿œã™ã‚‹ãƒªã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
	local l = 0 -- æœ€å¾Œã®boxã«å¯¾å¿œã™ã‚‹ãƒªã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
	if d_num <= box_num then -- ã™ã¹ã¦ã®boxãŒè¦‹ãˆã‚‹ã¾ã§
		f = 1
		l = d_num
		print('in box')
	elseif d_num > box_num and d_num >= (box_num + view_num - 1) then
		f = view_num
		l = box_num + view_num - 1
		print('box out')
	elseif d_num < (box_num + view_num - 1) then
		f = view_num
		l = d_num
		print('full')
	end

	for j = f, l do
		n = n + 1 -- æ›´æ–°å¯¾è±¡ãƒœãƒƒã‚¯ã‚¹
		for i, p in ipairs(list_texture) do
			-- gui.set_texture(box[d_num][p], texture))
		end
		for i, p in ipairs(list_text) do
			-- pprint(listdata[j][i])
			gui.set_text(gui.get_node(box[n] .. p), listdata[j][i])
		end
	end
end
-- æœ€åˆã¨æœ€å¾Œã®ãƒœãƒƒã‚¯ã‚¹ã‚’ç§»å‹•ã•ã›ã‚‹
local function box_move(self, scroll)
	if d_num >= box_num then
		if scroll.dy >= next_view and view_num < (d_num - (visible_box + 1)) then
			view_num = view_num + 1
			prev_view = next_view
			next_view = next_view + bm
			local po = vmath.vector3(0, ((view_num + visible_box) * -bm), 0)
			l_num = box_num + view_num - 1
			-- ãƒœãƒƒã‚¯ã‚¹å…¥ã‚Œæ›¿ãˆ
			gui.set_position(gui.get_node(box[1] .. list_box), po)
			table.insert(box, box_num + 1, box[1])
			table.remove(box, 1)
			-- ä¸€ç•ªæœ€å¾Œã®ãƒœãƒƒã‚¯ã‚¹ã‚’æ›¸ãæ›ãˆ
			write(self, box_num, l_num)
			print('move1')
		elseif scroll.dy < next_view and view_num == (d_num - visible_box) then
			view_num = view_num - 1
			next_view = prev_view
			prev_view = prev_view - bm
			local po = vmath.vector3(0, ((view_num - 1) * -bm), 0)
			l_num = view_num
			-- ãƒœãƒƒã‚¯ã‚¹å…¥ã‚Œæ›¿ãˆ
			gui.set_position(gui.get_node(box[box_num] .. list_box), po)
			table.insert(box, 1, box[box_num])
			table.remove(box, box_num + 1)
			-- ä¸€ç•ªæœ€åˆã®ãƒœãƒƒã‚¯ã‚¹ã‚’æ›¸ãæ›ãˆ
			write(self, 1, l_num)
			print('move2')
		elseif scroll.dy < prev_view and view_num > 1 then
			view_num = view_num - 1
			next_view = prev_view
			prev_view = prev_view - bm
			local po = vmath.vector3(0, ((view_num - 1) * -bm), 0)
			l_num = view_num
			-- ãƒœãƒƒã‚¯ã‚¹å…¥ã‚Œæ›¿ãˆ
			gui.set_position(gui.get_node(box[box_num] .. list_box), po)
			table.insert(box, 1, box[box_num])
			table.remove(box, box_num + 1)
			-- ä¸€ç•ªæœ€åˆã®ãƒœãƒƒã‚¯ã‚¹ã‚’æ›¸ãæ›ãˆ
			write(self, 1, l_num)
			print('move3')
		end
	end
	-- print('d_num'..d_num)
	-- print('view_num'..view_num)
	-- print('prev'..prev_view)
	-- print('next'..next_view)
	-- print('dy'..scroll.dy)
	-- pprint(box)
end
-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç§»å‹•åæ˜ 
local function scrolling(self, node, parent, scroll)
	if parent then
		local ms = gui.get_size(parent)
		local min_y = 0
		local max_y = math.max(0, scroll.oh - ms.y)

		if scroll.dy < min_y then
			scroll.dy = min_y
		end
		if scroll.dy > max_y then
			scroll.dy = max_y
		end
		-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ä½ç½®åæ˜ 
		if scroll.bar_y and max_y > 0 then
			local delta_y = scroll.dy / max_y
			local bar_s = gui.get_size(scroll.bar_y)
			local p = vmath.vector3(ms.x, -(ms.y - bar_s.y) * delta_y, 0)
			gui.set_position(scroll.bar_y, p)
		elseif scroll.bar_y and max_y == 0 then
			gui.set_position(scroll.bar_y, vmath.vector3(ms.x, 0, 0))
		end
	end
	-- å‰å¾Œãƒœãƒƒã‚¯ã‚¹ç§»å‹•
	box_move(self, scroll)
	-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã®ä½ç½®åæ˜ 
	gui.set_position(node, vmath.vector3(scroll.ox, scroll.oy + scroll.dy, 0))
end
-- æœ€åˆã«boxè¿½åŠ 
local function init_add_box(self)
	for i = 1, box_num, 1 do
		local b = 'box' .. tostring(i)
		box[i] = b
	end
end
-- boxè¿½åŠ 
local function add_box(self)
	scok = false
	-- ãƒ‡ãƒ¼ã‚¿æ•°+1
	d_num = d_num + 1
	-- è¿½åŠ ã™ã‚‹ãƒ‡ãƒ¼ã‚¿
	local para = para(self)
	table.insert(listdata, para)
	-- ãƒ‡ãƒ¼ã‚¿æ›´æ–°æ›¸ãæ›ãˆ
	if d_num <= box_num then -- ãƒ‡ãƒ¼ã‚¿æ•°ãŒãƒœãƒƒã‚¯ã‚¹ã®æ•°åŸ‹ã¾ã‚‹ã¾ã§
		local pos = vmath.vector3(visb, (-bm * (d_num - 1)), 0)
		gui.set_position(gui.get_node(box[d_num] .. list_box), pos)
		write(self, d_num, d_num)
	else -- ãƒœãƒƒã‚¯ã‚¹ã®æ•°ã‚ˆã‚Šãƒ‡ãƒ¼ã‚¿æ•°ãŒå¢—ãˆãŸã¨ãæœ€å¾Œã®ãƒœãƒƒã‚¯ã‚¹ã‚’æ›¸ãæ›ãˆ
		l_num = box_num + view_num - 1
		write(self, box_num, l_num)
	end
	-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ã®ä½ç½®ã¨ãƒãƒ¼ã‚’æ›´æ–°
	if d_num >= visible_box + 1 then
		local node = gui.get_node('scrollarea')
		local parent = gui.get_parent(node)
		s = gui.get_size(node)
		m = gui.get_size(parent)
		s.y = s.y + bm
		gui.set_size(node, s)
		gui.set_size(gui.get_node('scrollarea_bary'), vmath.vector3(sbx, m.y ^ 2 / s.y, 0))
		self.scrollarea.oh = s.y
		scrolling(self, node, parent, self.scrollarea)
	end
	scok = true
end
-- boxå‰Šé™¤
local function remove_box(self)
	scok = false
	if d_num > 0 then
		-- æœ€å¾Œã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¶ˆã™
		table.remove(listdata, d_num)
		d_num = d_num - 1
	-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ã®ä½ç½®ã¨ãƒãƒ¼ã‚’æ›´æ–°
		if d_num >= visible_box then
			local node = gui.get_node('scrollarea')
			local parent = gui.get_parent(node)
			s = gui.get_size(node)
			m = gui.get_size(parent)
			s.y = s.y - bm -- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ã‚’ãƒœãƒƒã‚¯ã‚¹ï¼‘å€‹åˆ†æ¸›ã‚‰ã™
			-- ã‚µã‚¤ã‚ºå¤‰æ›´ã‚’åæ˜ 
			gui.set_size(node, s)
			gui.set_size(gui.get_node('scrollarea_bary'), vmath.vector3(sbx, m.y ^ 2 / s.y, 0))
			self.scrollarea.oh = s.y
			scrolling(self, node, parent, self.scrollarea)
		end

		-- ãƒ‡ãƒ¼ã‚¿ãŒãƒœãƒƒã‚¯ã‚¹ã®æ•°ã‚ˆã‚Šå°‘ãªã„æ™‚ã€éè¡¨ç¤º
		if d_num < box_num then
			local pos = vmath.vector3(invisb, (-bm * d_num), 0)
			gui.set_position(gui.get_node(box[d_num + 1] .. list_box), pos)
		end

		allwrite(self)
	end
	scok = true
end
------------------------------------------------------------------------------------------------
-- Dirty Larry scroll Mod
------------------------------------------------------------------------------------------------
-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ã‚’å‹•ã‹ã™
local function sc(node_str, action_id, action, scroll, cb)
	local node = gui.get_node(node_str) --ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¨ãƒªã‚¢
	local parent = gui.get_parent(node) --ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ã®è¦ª
	local touch = action_id == hash('touch') --action_idã®ç¨®é¡ãŒå·¦ã‚¯ãƒªãƒƒã‚¯ã®æ™‚ã€è¨˜éŒ²
	local wup = action_id == hash('wup') --action_idã®ç¨®é¡ãŒãƒ›ã‚¤ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—ã®æ™‚ã€è¨˜éŒ²
	local wdown = action_id == hash('wdown') --action_idã®ç¨®é¡ãŒãƒ›ã‚¤ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã®æ™‚ã€è¨˜éŒ²

	-- local scroll = self.scrollarea
	local scroll = scroll
	-- scrollã«ä½•ã‚‚å…¥ã£ã¦ãªã„æ™‚ã€ã„ã‚ã„ã‚è¨­å®šã™ã‚‹
	if not scroll then
		local p = gui.get_position(node)
		scroll = {drag = false, started = false, dy = 0, ox = p.x, oy = p.y, ow = s.x, oh = s.y}
		-- scrollarea_baryã®ç”¨æ„ã—ã¦ãŠãã¨self.scrollareaã«è¿½åŠ ã•ã‚Œã‚‹
		scroll.bar_y = safe_get_node(node_str .. '_bary') --baryãã£ã¤ã‘ã¦ã‚ã£ãŸã‚‰è¿”ã™
	end
	if scroll.oh ~= s.y then
		scroll.oh = s.y
	end
	-- è§¦ã£ãŸãƒãƒ¼ãƒ‰ã®åå‰ã¨è¦ªã‚’è¨˜éŒ²ï¼ˆã‚ã‚‹å ´åˆï¼‰
	local hit = false
	if parent then
		hit = hit_test(self, parent, action_id, action)
	else
		hit = hit_test(self, node, action_id, action)
	end
	-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç§»å‹•ã®åˆ¤å®š
	local consumed_input = false
	-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç§»å‹•è¨ˆç®—
	if touch then
		-- ã‚¯ãƒªãƒƒã‚¯é›¢ã—ãŸã‚‰ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¨ãƒ‰ãƒ©ãƒƒã‚°ã®çµ‚ã‚ã‚Š
		if scroll.drag and action.released then
			-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ã„ã¦ã‚¨ãƒªã‚¢ã‚’ã¡ã‚‡ã£ã¨ã§ã‚‚å‹•ã‹ã—ãŸæ™‚ãƒ‰ãƒ©ãƒƒã‚°ã®å§‹ã¾ã‚Š
			-- ã‚¨ãƒªã‚¢å†…ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã®å§‹ã¾ã‚Š
			-- potentially start scroll/drag
			scroll.drag = false
			scroll.started = false
			consumed_input = true
		elseif hit and action.pressed then
			scroll.started = true
			action.dx = 0
			action.dy = 0
		elseif scroll.started and hit and (action.dy ~= 0) then
			scroll.drag = true
			scroll.started = false
			consumed_input = true
		end

		-- ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã„ã‚‹æ™‚ã€€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã®å·®åˆ†ã‚’è¨ˆç®—
		if scroll.drag then
			consumed_input = true
			scroll.dy = scroll.dy + action.dy

			scrolling(self, node, parent, scroll)
		end
	elseif wup or wdown then
		consumed_input = true
		if wup then
			scroll.dy = scroll.dy - bh
		elseif wdown then
			scroll.dy = scroll.dy + bh
		end

		scrolling(self, node, parent, scroll)
	end

	--ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¨ãƒªã‚¢å†…ã‚’è§¦ã£ã¦ã„ã¦ã€ã¾ã ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç§»å‹•ã—ã¦ã„ãªã„æ™‚
	if not consumed_input and ((touch and hit) or not touch) then
		cb(self, action_id, action)
	end

	return scroll
end
------------------------------------------------------------------------------------------------
-- init and on_input
------------------------------------------------------------------------------------------------
-- æœ€åˆã«å®Ÿè¡Œ
function init(self)
	math.randomseed(os.time())
	msg.post('.', 'acquire_input_focus')
	-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ã€ãƒœãƒƒã‚¯ã‚¹ã€ãƒã‚¹ã‚¯ã®ä½ç½®å¤§ãã•å–å¾—
	m = gui.get_size(gui.get_node('mask'))
	s = gui.get_size(gui.get_node('scrollarea'))
	b = gui.get_size(gui.get_node('box1/box'))
	bh = b.y / 2 -- ãƒœãƒƒã‚¯ã‚¹ã®åŠåˆ†
	bm = b.y + 5 -- ãƒœãƒƒã‚¯ã‚¹ä½™ç™½ã‚’å«ã‚ãŸãƒœãƒƒã‚¯ã‚¹ã®é–“éš”
	-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®å¤§ãã•è¨­å®š
	gui.set_size(gui.get_node('scrollarea_bary'), vmath.vector3(sbx, m.y ^ 2 / s.y, 0))

	d_num = 0 -- ãƒ‡ãƒ¼ã‚¿ã®æ•°
	l_num = 0
	-- ãƒœãƒƒã‚¯ã‚¹ã®è¡¨ç¤ºåŸŸ
	view_num = 1
	next_view = bh + bm
	prev_view = bh - bm

	scok = true
	-- ãƒœãƒƒã‚¯ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®åå‰ã‚’è¿½åŠ 
	init_add_box(self)
end

-- å…¥åŠ›æ™‚å®Ÿè¡Œ
function on_input(self, action_id, action)
	if scok then
		self.scrollarea =
			sc(
			'scrollarea',
			action_id,
			action,
			self.scrollarea,
			function(self, action_id, action)
				-- ãƒœã‚¿ãƒ³ã®ç¯„å›²å†…ã§ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚
				if action_id == hash('touch') and action.released then
					for i, p in ipairs(box) do
						if gui.pick_node(gui.get_node(p .. list_box), action.x, action.y) then
							print('push' .. tostring(p))
						end
					end
				end
				for i, p in ipairs(box) do
					local ob = gui.get_node(p .. list_box)
					if gui.pick_node(ob, action.screen_x, action.screen_y) then
						gui.animate(ob, 'color.w', 0.7, go.EASING_OUTQUAD, 0.1)
					else
						gui.animate(ob, 'color.w', 0.4, go.EASING_OUTQUAD, 0.1)
					end
				end
			end
		)

		if action_id == hash('touch') and action.pressed then
			if gui.pick_node(gui.get_node('add'), action.x, action.y) then
				add_box(self)
			elseif gui.pick_node(gui.get_node('remove'), action.x, action.y) then
				remove_box(self)
			end
		end

		if action_id == hash('space') and action.pressed then
			msg.post('@system:', 'toggle_profile')
		end
		if action_id == hash('keyz') and action.pressed then
			for i, p in ipairs(box) do
				gui.set_enabled(gui.get_node(p .. list_box), false)
			end
		end
		if action_id == hash('keyx') and action.pressed then
			for i, p in ipairs(box) do
				gui.set_enabled(gui.get_node(p .. list_box), true)
			end
		end
	end
end
/main/main.gui_script¡JLJ =/main/main.gui_scriptæ U+4  6  9) ) B6 -  BX	€6 9	 
 - 8 8BERõ- >L ÀÀ€insert
tableipairsrandom	mathlist_text paradata d_num self  para t   i 	p  	 Œ   &86  9 B  X€6    D 6  9 D is_enabledisenabledget_parentguiself  node  parent 
 8   D6   9  -  B K   Àget_nodeguinode  v  @6  3 B  X€6 9  2  €D X€+  2  €L 2  €K  get_nodegui 
pcall						node   å   LO6     B  X€+ L 6 9 99B6 ' B X€+ X€+  X€ L 
touch	hashyxpick_nodeguiisenabledself  node  action_id  action  hit touch  ‰  r[6  -  BX €ERş6  - BX€6 96	 9		-
 8

 &

B	-
 8

8

BERñK  ÀÀÀÀget_nodeset_textguiipairslist_texture list_text box listdata self  bn  ln    i  p     i p   Ğ MËe)  )  )  -  -  X€) -  6  ' BX €-  -  X€-  - -    X	€- - -   6  ' BX€-  - -    X€- -  6  ' B  ) M€ 6 -	 BX €ERş6 -	 BX€6 96 9- 8 &B- 88BERñOåK  €À	€ÀÀÀÀget_nodeset_textguiipairs	fullbox outin box
print	



d_num box_num view_num list_texture list_text box listdata self  Nn Lf Kl J-  j   i  p     i p   ç	 ËÀƒ1-  -  XÆ€9 -  XA€- -  -  ! X:€-  . - . - -  . 6 9)  - -  -  ")  B- -   . 6 96 9- :-	 &B B6 9- -  - :B6 9- ) B-
   - - B6	 '
 BX€9 -  X>€- -  - ! X8€-  . - . - - !. 6 9)  -  -  ")  B- . 6 96 9- - 8-	 &B B6 9- ) - - 8B6 9- -  B-
   ) - B6	 ' BX?€9 -  X;€- )  X7€-  . - . - - !. 6 9)  -  -  ")  B- . 6 96 9- - 8-	 &B B6 9- ) - - 8B6 9- -  B-
   ) - B6	 ' BK  €À
€	€À€€€ÀÀÀ
move3
move2
move1
printremoveinsert
tableget_nodeset_positionguivector3
vmathdy											







          !!############$$$$$$$$%%%%%%'''''(((1d_num box_num next_view view_num visible_box prev_view bm l_num box list_box write self  Ìscroll  Ìpo $%po C$po @$ Å R§¶  X?€6  9 B)  6 9)  99	!	B9 X€=9 X€=9  X€)   X€9#6  99	B6	 9			9

99! ")  B	6
  9

9	 B
X€9  X€	  X
€6  996	 9			9

)  )  B	 A-     B6  9 6 9	999	 	)	  B AK  Àoyoxset_positionxvector3
vmath
bar_ydyyohmax	mathget_sizegui 			
box_move self  Snode  Sparent  Sscroll  Sms ;min_y :max_y 3delta_y bar_s p 
 ‚  2Ò) -  ) M€'  6  B&- <OøK  ÀÀtostringboxbox_num box self  	 	 	i b  ‚ 
w…Ù1  -  . -   B6  9-  B- -  X€6 9- -  -  ")  B6 96 9- - 8- &B B-	   - - BX
€- -   .
 -	   - -
 B- -   X:€6 9' B6 9 B6 9	 B. 6 9	 B. - - 9
-  =
6 9 - B6 96 9' B6 9- - 9
)	 %	-	 9	
	#	)	  B A9 - 9
=-     9 B1  K  €€ÀÀÀÀ€ÀÀÀ€	€À€ €ÀÀohscrollarea_baryset_sizeyget_sizeget_parentscrollareaget_nodeset_positionguivector3
vmathinsert
table										











scok d_num para listdata box_num visb bm box list_box write l_num view_num visible_box s m sbx scrolling self  xpara ppos node %6parent 2 ¥ 	jâø1  - )   Xc€6  9- - B-  . - -  X:€6 9' B6 9 B6 9 B. 6 9 B. - - 9- !=6 9 - B6 96 9'	 B6
 9- - 9) %- 9#)  B A9 - 9=-     9 B- -	  X€6
 9-
 -  - ")  B6 96 9- -  8- &B B-   B1  K  €€ÀÀ€ €€ÀÀÀÀÀÀÀset_positionohvector3
vmathscrollarea_baryset_sizeyget_sizeget_parentscrollareaget_nodeguiremove
table				




scok d_num listdata visible_box s m bm sbx scrolling box_num invisb box list_box allwrite self  knode 6parent 2pos ? È	 °ÚšH6  9  B6  9 B6 ' B X€+ X€+ 6 '	 B X€+ X	€+ 6	 '
 B		 X	€+	 X
€+	 
  
 X€6  9 B5 9	=
9=-  9	=-  9=
 -   ' &B=
9
-  9 X€-  9=
+   X€- 6    B X€- 6    B +   X4€9
  X	€9  X€+ =
+ =
+ X€  X
€9  X€+ =
)  =)  =X€9
  X
€  X€9  X€+ =
+ =
+ 9
  X$€+ 9
9 =
- 6   
 BX€  X€ 	 X€+   X€9
- !=
X€ 	 X€9
-  =
- 6   
 B  X€  X€  X€  X€ 6   BL
 €ÀÀÀ€dydxpressedstartedreleased	drag	self
_bary
bar_yohowoyyoxx dy started	dragget_position
wdownwup
touch	hashget_parentget_nodegui 

##$$%%&&&&&''(()))********++,,-1112333355555567777899:::::;;<<<<??????CCCCCCCCDDDDDGs safe_get_node hit_test scrolling bh node_str  ±action_id  ±action  ±scroll  ±cb  ±node ¬parent ¨touch  wup ˜wdown scroll p hit nconsumed_input \ ’ N¡ç6  96 9B A 6 9' ' B6 9	6 9
' B A .  6 9	6 9
' B A . 6 9	6 9
' B A . - 9 . - 9. 6 96 9
' B6 9- -  9) %- 9#)  B A0 0 0 - -  .	 - - !.
 1 -   BK   €€€€€À€€	€
€€€Àvector3
vmathscrollarea_baryset_sizeybox1/boxscrollarea	maskget_nodeget_sizeguiacquire_input_focus.	postmsg	timeosrandomseed	math
 


















m s b bh bm sbx d_num l_num view_num next_view prev_view scok init_add_box self  O ï J›ˆ6  ' B X€9  X€6 -  BX€6 96	 9		
 - &

B	9
9B  X	€6	 '	
 6
  B
&	
	BERê6 -  BX!€6 9	 -
 &	
	B6	 9		
 99B	 	 X

€6	 9		
 ' *  6 9* B	X		€6	 9		
 ' * 6 9* B	ERİK    EASING_OUTQUADgocolor.wanimatescreen_yscreen_xtostring	push
printyxget_nodepick_nodeguiipairsreleased
touch	hashÍ™³ææÌ™ÿµæÌ™™³æıµæÌ™™³æş				





		box list_box self  Kaction_id  Kaction  K  i p  $ $ $i !p  !ob  ® nÕ€2-    Xj€- '    9  3 B=  6 ' B X €9  X€6 96 9' B9	9
B  X€-   BX€6 96 9' B9	9
B  X€-   B6 ' B X€9  X€6 9' ' B6 ' B X€9  X€6 - BX
€6 96	 9		
 - &

B	+
 BERô6 ' B X€9  X€6 - BX
€6 96	 9		
 - &

B	+
 BERôK  €!ÀÀÀÀ À	keyxset_enabledipairs	keyztoggle_profile@system:	postmsg
spaceremoveyxaddget_nodepick_nodeguipressed
touch	hash scrollarea   $$$$$$$$%%%%%''''''''(((())))))))))((,,,,,,,,----..........--2scok sc box list_box add_box remove_box self  oaction_id  oaction  oI  i 
p  
  i 
p  
 º #  ) ³,  )  )Â) ,	 ) ) 4  +  '  5 5 +  4  + 4 5 >5 >5 >3 3 7 3	 3
 3 3 3 3 3 3 3  3! 3" 7" 3" 7" 2  €K  on_input 	init           isenabled    c_chan  
b_kun)3s  
a_san	  
/NAME/HP/SP
/LUCK	/ATK	/DEX	/AGI
/rank	/EXP/EXP_max/listID  /picture/team_icon/element_icon	/box               $ $ % % & & ' 3 > 8 M V c  ´ Ğ × ö b}g²€²²m (s  (ks  (b  (bh  (bm  (visb 'invisb &sbx %view_num $next_view  $prev_view  $box_num #visible_box "box !l_num  list_box list_texture list_text d_num listdata scok paradata para safe_get_node hit_test write allwrite box_move scrolling 
init_add_box 	add_box remove_box sc   "¡JLJ=/main/main.gui_scriptæ U+4  6  9) ) B6 -  BX	€6 9
  - 8 8BERõ- >L ÀÀ€insert
tableipairsrandom	mathlist_text paradata d_num self  para t   i 	p  	 Œ   &86  9 B  X€6    D 6  9 D is_enabledisenabledget_parentguiself  node  parent 
 8   D6   9  -  B K   Àget_nodeguinode  v  @6  3 B  X€6 9  2  €D X€+  2  €L 2  €K  get_nodegui 
pcall						node   å 	  LO6     B  X€+ L 6 9 99B6 ' B X€+ X€+  X€ L 
touch	hashyxpick_nodeguiisenabledself  node  action_id  action  hit touch  ‰  r[6  -  BX €ERş6  - BX€6 96
 9

- 8 &B
- 88BERñK  ÀÀÀÀget_nodeset_textguiipairslist_texture list_text box listdata self  bn  ln    i  p     i p   Ğ MËe)  )  )  -  -  X€) -  6  ' BX €-  -  X€-  - -    X	€- - -   6  ' BX€-  - -    X€- -  6  ' B  ) M€ 6 -
 BX €ERş6 -
 BX€6 96 9- 8 &B- 88BERñOåK  €À	€ÀÀÀÀget_nodeset_textguiipairs	fullbox outin box
print	



d_num box_num view_num list_texture list_text box listdata self  Nn Lf Kl J-  j   i  p     i p   ç	 	ËÀƒ1-  -  XÆ€9 -  XA€- -  -  ! X:€-  . - . - -  . 6 9)  - -  -  ")  B- -   . 6 96 9- :-	 &B B6 9- -  - :B6 9- ) B-
   - - B6	 '
 BX€9 -  X>€- -  - ! X8€-  . - . - - !. 6 9)  -  -  ")  B- . 6 96 9- - 8-	 &B B6 9- ) - - 8B6 9- -  B-
   ) - B6	 ' BX?€9 -  X;€- )  X7€-  . - . - - !. 6 9)  -  -  ")  B- . 6 96 9- - 8-	 &B B6 9- ) - - 8B6 9- -  B-
   ) - B6	 ' BK  €À
€	€À€€€ÀÀÀ
move3
move2
move1
printremoveinsert
tableget_nodeset_positionguivector3
vmathdy											







          !!############$$$$$$$$%%%%%%'''''(((1d_num box_num next_view view_num visible_box prev_view bm l_num box list_box write self  Ìscroll  Ìpo $%po C$po @$ Å R§¶  X?€6  9 B)  6 9)  9	9
!	
	B9 X€=9 X€=9  X€)   X€9#6  99
B6	 9			9
99! ")  B	6
  9

9	 B
X€9  X€	  X
€6  99	6
 9
	
9
)  )  B
 A-     B6  9 6 9	9	9
9 

)  B AK  Àoyoxset_positionxvector3
vmath
bar_ydyyohmax	mathget_sizegui 			
box_move self  Snode  Sparent  Sscroll  Sms ;min_y :max_y 3delta_y bar_s p 
 ‚ 	 2Ò) -  ) M€'  6  B&- <OøK  ÀÀtostringboxbox_num box self  	 	 	i b  ‚ w…Ù1  -  . -   B6  9-  B- -  X€6 9- -  -  ")  B6 96 9- - 8- &B B-	   - - BX
€- -   .
 -	   - -
 B- -   X:€6 9' B6 9 B6 9	 B. 6 9	 B. - - 9
-  =
6 9 - B6 96 9' B6 9-	 -
 9


) %

- 9
#

)  B A9 - 9
=-     9	 B1  K  €€ÀÀÀÀ€ÀÀÀ€	€À€ €ÀÀohscrollarea_baryset_sizeyget_sizeget_parentscrollareaget_nodeset_positionguivector3
vmathinsert
table										











scok d_num para listdata box_num visb bm box list_box write l_num view_num visible_box s m sbx scrolling self  xpara ppos node %6parent 2 ¥ jâø1  - )   Xc€6  9- - B-  . - -  X:€6 9' B6 9 B6 9 B. 6 9 B. - - 9- !=6 9 - B6 96 9'	 B6
 9- -	 9		)
 %	
	-
 9

#	
	)
  B A9 - 9=-     9 B- -	  X€6
 9-
 -  - ")  B6 96 9- -  8- &B B-   B1  K  €€ÀÀ€ €€ÀÀÀÀÀÀÀset_positionohvector3
vmathscrollarea_baryset_sizeyget_sizeget_parentscrollareaget_nodeguiremove
table				




scok d_num listdata visible_box s m bm sbx scrolling box_num invisb box list_box allwrite self  knode 6parent 2pos ? È	 °ÚšH6  9  B6  9 B6 '	 B X€+ X€+ 6 '
 B X€+ X	€+ 6	 ' B		 X	€+	 X
€+	 
  
 X€6  9 B5 9	=
9=-  9	=-  9=
 -   ' &B=
9
-  9 X€-  9=
+   X€- 6    B X€- 6    B +   X4€9
  X	€9  X€+ =
+ =
+ X€  X
€9  X€+ =
)  =)  =X€9
  X
€  X€9  X€+ =
+ =
+ 9
  X$€+ 9
9 =
- 6   
 BX€  X€ 	 X€+   X€9
- !=
X€ 	 X€9
-  =
- 6   
 B  X€  X€  X€  X€ 6   BL
 €ÀÀÀ€dydxpressedstartedreleased	drag	self
_bary
bar_yohowoyyoxx dy started	dragget_position
wdownwup
touch	hashget_parentget_nodegui 

##$$%%&&&&&''(()))********++,,-1112333355555567777899:::::;;<<<<??????CCCCCCCCDDDDDGs safe_get_node hit_test scrolling bh node_str  ±action_id  ±action  ±scroll  ±cb  ±node ¬parent ¨touch  wup ˜wdown scroll p hit nconsumed_input \ ’ 	N¡ç6  96 9B A 6 9' ' B6 9	6 9
' B A .  6 9	6 9
' B A . 6 9	6 9
' B A . - 9 . - 9. 6 96 9
' B6 9- -  9) %- 9#)  B A0 0 0 - -  .	 - - !.
 1 -   BK   €€€€€À€€	€
€€€Àvector3
vmathscrollarea_baryset_sizeybox1/boxscrollarea	maskget_nodeget_sizeguiacquire_input_focus.	postmsg	timeosrandomseed	math
 


















m s b bh bm sbx d_num l_num view_num next_view prev_view scok init_add_box self  O ï J›ˆ6  ' B X€9  X€6 -  BX€6 96
 9

 - &B
99B  X	€6	 '

 6  B&

BERê6 -  BX!€6 9
 - &

B6	 9		 99B	 	 X

€6	 9		 ' *  6 9* B	X		€6	 9		 ' * 6 9* B	ERİK    EASING_OUTQUADgocolor.wanimatescreen_yscreen_xtostring	push
printyxget_nodepick_nodeguiipairsreleased
touch	hashÍ™³ææÌ™ÿµæÌ™™³æıµæÌ™™³æş				





		box list_box self  Kaction_id  Kaction  K  i p  $ $ $i !p  !ob  ® nÕ€2-    Xj€- '    9  3	 B=  6 ' B X €9  X€6 96 9' B9	9
B  X€-   BX€6 96 9' B9	9
B  X€-   B6 ' B X€9  X€6 9' ' B6 ' B X€9  X€6 - BX
€6 96
 9

 - &B
+ BERô6 ' B X€9  X€6 - BX
€6 96
 9

 - &B
+ BERôK  €!ÀÀÀÀ À	keyxset_enabledipairs	keyztoggle_profile@system:	postmsg
spaceremoveyxaddget_nodepick_nodeguipressed
touch	hash scrollarea   $$$$$$$$%%%%%''''''''(((())))))))))((,,,,,,,,----..........--2scok sc box list_box add_box remove_box self  oaction_id  oaction  oI  i 
p  
  i 
p  
 º #  ) ³,  )  )Â) ,	 ) ) 4  +  '  5 5 +  4  + 4 5 >5 >5 >3 3 7 3	 3
 3 3 3 3 3 3 3  3! 3" 7" 3" 7" 2  €K  on_input 	init           isenabled    c_chan  
b_kun)3s  
a_san	  
/NAME/HP/SP
/LUCK	/ATK	/DEX	/AGI
/rank	/EXP/EXP_max/listID  /picture/team_icon/element_icon	/box               $ $ % % & & ' 3 > 8 M V c  ´ Ğ × ö b}g²€²²m (s  (ks  (b  (bh  (bm  (visb 'invisb &sbx %view_num $next_view  $prev_view  $box_num #visible_box "box !l_num  list_box list_texture list_text d_num listdata scok paradata para safe_get_node hit_test write allwrite box_move scrolling 
init_add_box 	add_box remove_box sc   " 